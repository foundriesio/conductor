- deploy:
    timeout:
      minutes: 20
{% if device_type == "imx8mmevk" or device_type == "imx8mp-lpddr4-evk" or device_type == "imx8mmevk-sec" %}
    to: downloads
{% else %}
    to: flasher
{% endif %}
    images:
      image:
        url: {{ IMAGE_URL }}
        compression: gz
        headers:
          OSF-TOKEN: OSF-TOKEN
{% if device_type == "imx8mmevk" or device_type == "imx6ullevk" or device_type == "imx8mp-lpddr4-evk" or device_type == "imx8mmevk-sec" %}
      bootloader:
        url: {{ BOOTLOADER_URL }}
        headers:
          OSF-TOKEN: OSF-TOKEN
{% endif %}
{% if device_type == "imx8mmevk" or device_type == "imx6ullevk" or device_type == "imx8mmevk-sec" %}
      sitimg:
        url: {{ SITIMG_URL }}
        headers:
          OSF-TOKEN: OSF-TOKEN
{% endif %}
{% if device_type == "imx6ullevk" %}
      splimage:
        url: {{ SPLIMG_URL }}
        headers:
          OSF-TOKEN: OSF-TOKEN
{% endif %}
{% if device_type == "imx8mmevk" or device_type == "imx8mp-lpddr4-evk" or device_type == "imx8mmevk-sec" %}
      uboot:
        url: {{ UBOOT_URL }}
        headers:
          OSF-TOKEN: OSF-TOKEN
{% endif %}
{% if device_type == "imx8mmevk" or device_type == "imx8mp-lpddr4-evk" or device_type == "imx8mmevk-sec" %}
      mfgtools:
        url: {{ MFGTOOL_URL }}
        headers:
          OSF-TOKEN: OSF-TOKEN
    postprocess:
       docker:
          image: miloszwasilewski/lmp-sign
          steps:
            - "export IMAGE_PATH=$PWD"
            - ls -l
            - rm -rf mfgtool-files | true
            - mkdir mfgtool-files
            - tar -C mfgtool-files --strip-components=1 -xvf mfgtool-files.tar.gz
            - rm mfgtool-files.tar.gz
{% if device_type == "imx8mmevk-sec" %}
            - "/home/lmp-tools/security/imx_hab4/sign-file.sh --cst /home/cst-3.3.1/linux64/bin/cst --spl $IMAGE_PATH/imx-boot-{{ device_type }} --csf-template /home/lmp-tools/security/imx_hab4/u-boot-spl-sign.csf-template --key-dir /home/lmp-tools/security/imx_hab4/"
            - "/home/lmp-tools/security/imx_hab4/sign-file.sh --cst /home/cst-3.3.1/linux64/bin/cst --spl $IMAGE_PATH/mfgtool-files/imx-boot-mfgtool --csf-template /home/lmp-tools/security/imx_hab4/u-boot-spl-sign.csf-template --key-dir /home/lmp-tools/security/imx_hab4/"
{% endif %}
            - tar  -C $IMAGE_PATH -czvf mfgtool-files.tgz mfgtool-files
            - ls -l $IMAGE_PATH
{% endif %}
