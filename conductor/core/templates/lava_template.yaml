timeouts:
  job:
    minutes: 40
  connection:
    minutes: 5
  action:
    minutes: 4
context:
  test_character_delay: 10
  lava_test_results_dir: "/home/fio/lava-%s"
device_type: {{ device_type }}
job_name: basic tests - {{ target }}
priority: 50
visibility: public
metadata:
  build-url: '{{ build_url }}'
  build-id: '{{ build_id }}'
  trigger: '{{ trigger }}'
actions:
{% include "deploy.inc.yaml" %}
{% include "deploy2.inc.yaml" %}
- command:
    name: network_turn_on
- boot:
{% include "boot.inc.yaml" %}

- test:
    timeout:
      minutes: 20
    definitions:
    # this is not a real test. It registers the device
    # and prevents aklite to force reboot
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/disable-aklite-reboot/disable-aklite-reboot.yaml
      name: disable-aklite-reboot
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/fs-resize/fs-resize.yaml
      name: fs-resize
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/timesyncd/timesyncd.yaml
      name: timesyncd
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/network-basic/network-basic.yaml
      name: network-basic
      params:
        INTERFACE: "{{ net_interface }}"
        SKIP_INSTALL: true
        CURL: "wget -O"
        DHCLIENT: "udhcpc -i"
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/docker/docker.yaml
      name: docker
      params:
        IMAGE: "hello-world"
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/docker-networking/docker-networking.yaml
      name: docker-networking
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/kernel-config-checker/kernel-config-checker.yaml
      name: kernel-config-checker
      params:
        # add more mandatory configs here
        CONFIG_VALUES: "CONFIG_CGROUPS"
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/ostree/ostree.yaml
      name: ostree
      params:
        OSTREE_HASH: "{{ os_tree_hash }}"
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/aklite/aklite.yaml
      name: aklite
      params:
        TARGET: {{ target }}
{% if device_type == "imx8mmevk" or device_type == "raspberrypi4-64" or device_type == "stm32mp1-disco" %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/wlan-smoke/wlan-smoke.yaml
      name: wlan-smoke
      params:
        DEVICE: "wlan0"
{% endif %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/ima/ima.yaml
      name: ima-smoke
{% if device_type == "raspberrypi4-64" or device_type == "stm32mp1-disco" %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/hci-smoke/hci-smoke.yaml
      name: hci-smoke
      params:
        MODE: "scan lescan"
    {% if device_type == "stm32mp1-disco" %}
        BOOT: "disabled"
    {% endif %}
{% endif %}
{% if device_type == "raspberrypi4-64" or device_type == "stm32mp1-disco" or device_type == "imx8mmevk" %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/wlan-download/wlan-download.yaml
      name: wlan-download
      params:
{% if device_type == "imx8mmevk" %}
        TIME_DELAY: 120s
{% endif %}
        DEVICE: wlan0
        ETHERNET_DEVICE: "{{ net_interface }}"
        SSID_NAME: Foundriesio
        SSID_PASSWORD: StrictlyComeDancing
        FILE_URL: http://archive.ubuntu.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/mini.iso
        FILE_CHECKSUM: "8388f7232b400bdc80279668847f90da"
{% endif %}
{% if device_type == "imx8mmevk" or device_type == "imx6ullevk" %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/optee/optee-xtest.yaml
      name: optee-xtest
{% endif %}
    - repository: http://github.com/linaro/test-definitions.git
      from: git
      path: automated/linux/network-manager/network-manager.yaml
      name: network-manager
      params:
        INTERFACE: "{{ net_interface }}"
